- hosts: localhost
  
  tasks:
  - name: Creating exports file in localhost
    copy:
      dest: /tmp/exports
      content: "/{{ server_bak_dir }} {{ client_ip }}(rw,no_root_squash)"
  
  
  
- hosts: all
  vars:
  - distro_name: "{{ ansible_facts['distribution'] }}"

  handlers:
  - name: Restart nfs-utils
    service:
        name: "nfs-utils"
        state: "restarted"
        enabled: yes

  tasks:
  - name: Install package nfs-utils if distro == RedHat (package module)
    package:
       name: "nfs-utils"
       state: present
    become: true
    become_user: root
    when: distro_name == "RedHat"


  - name: Install package nfs-utils if distro == Debian (package module)
    package:
       name: "nfs-utils"
       state: present
    become: true
    become_user: root
    when: distro_name == "Debian" 
       

  - name: Creating Server backup folder (file module)
    file:
       state: "directory"
       path: "/home/{{ server_user_name }}/Desktop/{{ server_bak_dir }}"


  - name: Starting and enabling Service (service module)     
    service:
       name: "nfs-utils"
       state: "started"
       enabled: yes
   

  - name: creating exports file and sending to server (template module)     
    template:
       dest: "/etc/exports"
       src: "/tmp/exports"
    notify:
    - Restart nfs-utils


  - name: Disabling firewall permanantly (firewalld module)  
    firewalld:
       service: "nfs-utils"
       permanent: yes
       immediate: yes
       state: disabled
    
